// --- PREGUNTAS ---
const preguntas = [
  {
  texto: "Quina Ã©s la finalitat principal de la Directiva IPPC (61/1996)?",
  opciones: [
    "a) Fomentar el comerÃ§ entre paÃ¯sos europeus",
    "b) Prevenir i controlar de manera integrada la contaminaciÃ³ industrial",
    "c) Millorar la seguretat laboral a les indÃºstries",
    "d) Promoure la innovaciÃ³ tecnolÃ²gica en energia nuclear"
  ],
  correcta: "b"
},
{
  texto: "Com sâ€™anomena actualment la Directiva IPPC?",
  opciones: [
    "a) Directiva sobre emissions industrials",
    "b) Directiva de prevenciÃ³ de riscos laborals",
    "c) Directiva sobre desenvolupament sostenible",
    "d) Directiva de residus urbans"
  ],
  correcta: "a"
},
{
  texto: "Quin Ã©s lâ€™objectiu principal de la Directiva 75/2010/UE sobre emissions industrials?",
  opciones: [
    "a) Reunir en un Ãºnic text les directives anteriors sobre contaminaciÃ³",
    "b) Establir nous impostos sobre residus",
    "c) Definir els lÃ­mits de soroll en zones urbanes",
    "d) Promoure lâ€™Ãºs dâ€™energies renovables"
  ],
  correcta: "a"
},
{
  texto: "En quÃ¨ es basa el principi de 'prevenciÃ³ i control integrat'?",
  opciones: [
    "a) En actuar nomÃ©s sobre les emissions atmosfÃ¨riques",
    "b) En prevenir o reduir les emissions a lâ€™aire, a lâ€™aigua i al sÃ²l dâ€™una manera coordinada",
    "c) En millorar la rendibilitat de les empreses",
    "d) En centralitzar totes les competÃ¨ncies al Parlament Europeu"
  ],
  correcta: "b"
},
{
  texto: "Segons la Directiva, quÃ¨ passa si una activitat industrial no pot prevenir la contaminaciÃ³?",
  opciones: [
    "a) Ha de compensar econÃ²micament altres empreses",
    "b) Ha de reduir les emissions al mÃ­nim tÃ¨cnicament possible",
    "c) Pot continuar operant sense lÃ­mit",
    "d) Ha de tancar temporalment"
  ],
  correcta: "b"
},
{
  texto: "Quant temps tenen els estats membres per transposar una directiva europea al seu marc legal?",
  opciones: [
    "a) 6 mesos",
    "b) 1 any",
    "c) 2 anys",
    "d) 5 anys"
  ],
  correcta: "c"
},
{
  texto: "Quin article estableix lâ€™objecte principal de la Directiva 75/2010?",
  opciones: [
    "a) Article 1",
    "b) Article 11",
    "c) Article 22",
    "d) Article 30"
  ],
  correcta: "a"
},
{
  texto: "De quÃ¨ depÃ¨n la classificaciÃ³ dâ€™una activitat dins lâ€™Annex I de la Directiva?",
  opciones: [
    "a) De la localitzaciÃ³ geogrÃ fica",
    "b) Del tipus dâ€™activitat i la seva capacitat productiva",
    "c) Del nombre dâ€™empleats",
    "d) Del pressupost de lâ€™empresa"
  ],
  correcta: "b"
},
{
  texto: "QuÃ¨ estableix lâ€™article 11 de la Directiva sobre les obligacions de lâ€™operador?",
  opciones: [
    "a) Que ha dâ€™aplicar les millors tÃ¨cniques disponibles i utilitzar energia eficientment",
    "b) Que ha de prioritzar el benefici econÃ²mic",
    "c) Que ha de reduir nomÃ©s la contaminaciÃ³ acÃºstica",
    "d) Que pot decidir lliurement els valors lÃ­mit dâ€™emissiÃ³"
  ],
  correcta: "a"
},
{
  texto: "Quin Ã©s un dels principis generals de lâ€™operador segons la Directiva?",
  opciones: [
    "a) Adoptar mesures preventives contra la contaminaciÃ³",
    "b) Augmentar la producciÃ³ sense lÃ­mits",
    "c) Subcontractar la gestiÃ³ ambiental",
    "d) Evitar auditories externes"
  ],
  correcta: "a"
},
{
  texto: "Segons lâ€™article 12, quÃ¨ ha dâ€™incloure una solÂ·licitud de permÃ­s ambiental?",
  opciones: [
    "a) NomÃ©s la descripciÃ³ de les activitats principals",
    "b) InformaciÃ³ sobre matÃ¨ries primeres, emissions previstes i tecnologia emprada",
    "c) NomÃ©s el pla financer de lâ€™empresa",
    "d) Dades sobre el nombre dâ€™empleats"
  ],
  correcta: "b"
},
{
  texto: "QuÃ¨ sâ€™entÃ©n per Millors TÃ¨cniques Disponibles (MTD)?",
  opciones: [
    "a) Les tÃ¨cniques mÃ©s barates disponibles al mercat",
    "b) Les tÃ¨cniques mÃ©s avanÃ§ades i efectives per reduir emissions sense perjudicar lâ€™economia",
    "c) NomÃ©s les tÃ¨cniques que utilitzen energia renovable",
    "d) Totes les tÃ¨cniques experimentals"
  ],
  correcta: "b"
},
{
  texto: "Les MTD (Millors TÃ¨cniques Disponibles) tenen en compte:",
  opciones: [
    "a) NomÃ©s el cost econÃ²mic",
    "b) El cost, la ubicaciÃ³ i les condicions locals",
    "c) NomÃ©s la productivitat",
    "d) NomÃ©s la tecnologia emprada"
  ],
  correcta: "b"
},
{
  texto: "QuÃ¨ sÃ³n els Valors LÃ­mit dâ€™EmissiÃ³ (VLE)?",
  opciones: [
    "a) Els nivells mÃ xims dâ€™emissiÃ³ que no es poden superar en un perÃ­ode determinat",
    "b) El consum mÃ xim dâ€™energia per unitat de producte",
    "c) Els valors mÃ­nims dâ€™emissiÃ³ per a una indÃºstria",
    "d) Els lÃ­mits econÃ²mics de la producciÃ³"
  ],
  correcta: "a"
},
{
  texto: "En quÃ¨ es basen els Valors LÃ­mit dâ€™EmissiÃ³ (VLE)?",
  opciones: [
    "a) En les Millors TÃ¨cniques Disponibles (MTD)",
    "b) En la voluntat de cada empresa",
    "c) En les emissions mitjanes dâ€™un paÃ­s",
    "d) En la densitat de poblaciÃ³"
  ],
  correcta: "a"
},
{
  texto: "QuÃ¨ sÃ³n els Documents de ReferÃ¨ncia (BREF)?",
  opciones: [
    "a) Documents que descriuen les MTD i emissions actuals per sectors industrials",
    "b) Guies de seguretat laboral",
    "c) Informes econÃ²mics de la UE",
    "d) Manuals de gestiÃ³ energÃ¨tica"
  ],
  correcta: "a"
},
{
  texto: "Qui redacta els Documents de ReferÃ¨ncia (BREF)?",
  opciones: [
    "a) Grups de treball europeus que intercanvien informaciÃ³ i arriben a consens sobre les MTD",
    "b) Cada empresa individualment",
    "c) Els governs locals",
    "d) Les ONG ambientals"
  ],
  correcta: "a"
},
{
  texto: "Cada quant temps sâ€™haurien dâ€™actualitzar els Documents de ReferÃ¨ncia (BREF)?",
  opciones: [
    "a) Cada 2 anys",
    "b) Cada 5 anys",
    "c) Cada 8 anys",
    "d) Cada 10 anys"
  ],
  correcta: "c"
},
{
  texto: "Segons la Directiva, quina Ã©s la definiciÃ³ dâ€™emissiÃ³?",
  opciones: [
    "a) Alliberament directe o indirecte de substÃ ncies, vibracions, calor o soroll al medi ambient",
    "b) NomÃ©s la sortida de gasos per una xemeneia",
    "c) NomÃ©s les emissions lÃ­quides a lâ€™aigua",
    "d) La quantitat de productes fabricats"
  ],
  correcta: "a"
},
{
  texto: "Quin objectiu tenen els permisos ambientals segons la Directiva dâ€™Emissions Industrials?",
  opciones: [
    "a) Permetre operar sota condicions controlades per reduir lâ€™impacte ambiental",
    "b) Autoritzar qualsevol tipus dâ€™activitat sense restriccions",
    "c) Recaudar impostos ambientals",
    "d) Facilitar la construcciÃ³ de noves infraestructures"
  ],
  correcta: "a"
},
{
  texto: "Quina era la normativa espanyola que classificava activitats com a molestes, insalubres, nocives i perilloses?",
  opciones: [
    "a) Decret 2414/1961 (RAMINP)",
    "b) Llei 16/2002",
    "c) Llei 21/1990",
    "d) Reial Decret 815/2013"
  ],
  correcta: "a"
},
{
  texto: "Quina era la naturalesa del Reglament RAMINP (1961)?",
  opciones: [
    "a) Preventiva i amb controls periÃ²dics",
    "b) Proteccionista, amb una Ãºnica inspecciÃ³ inicial i permÃ­s indefinit",
    "c) Basada en la sostenibilitat i lâ€™eficiÃ¨ncia energÃ¨tica",
    "d) Focalitzada nomÃ©s en residus urbans"
  ],
  correcta: "b"
},
{
  texto: "Quin era un problema del RAMINP segons els apunts?",
  opciones: [
    "a) Que nomÃ©s es controlava la contaminaciÃ³ atmosfÃ¨rica",
    "b) Que tenia una aproximaciÃ³ separativa amb moltes administracions implicades",
    "c) Que no permetia construir noves fÃ briques",
    "d) Que no existia cap inspecciÃ³ inicial"
  ],
  correcta: "b"
},
{
  texto: "Quina llei espanyola va transposar la Directiva IPPC al marc legal estatal?",
  opciones: [
    "a) Llei 16/2002",
    "b) Llei 20/2009",
    "c) Reial Decret 2414/1961",
    "d) Llei 3/1998"
  ],
  correcta: "a"
},
{
  texto: "Quin Reial Decret desenvolupa la Llei 16/2002 sobre PrevenciÃ³ i Control Integrats de la ContaminaciÃ³?",
  opciones: [
    "a) Reial Decret 815/2013",
    "b) Reial Decret 100/2010",
    "c) Reial Decret 120/2008",
    "d) Reial Decret 777/2015"
  ],
  correcta: "a"
},
{
  texto: "Quin text refÃ³s aprova la Llei sobre PrevenciÃ³ i Control Integrats de la ContaminaciÃ³?",
  opciones: [
    "a) Reial Decret Legislatiu 1/2016",
    "b) Llei 3/1998",
    "c) Reial Decret 815/2013",
    "d) Llei 21/1990"
  ],
  correcta: "a"
},
{
  texto: "Quantes instalÂ·lacions formaven part de lâ€™Annex I de la Llei 16/2002 lâ€™any 2024?",
  opciones: [
    "a) 2.000",
    "b) 5.500",
    "c) 9.033",
    "d) 12.000"
  ],
  correcta: "c"
},
{
  texto: "Quina llei catalana va transposar la Directiva IPPC al marc legal autonÃ²mic?",
  opciones: [
    "a) Llei 3/1998 (LIIAA)",
    "b) Llei 16/2002",
    "c) Llei 20/2009 (PCAA)",
    "d) Decret 2414/1961"
  ],
  correcta: "a"
},
{
  texto: "Quin decret catalÃ  desenvolupa la Llei 3/1998 (LIIAA)?",
  opciones: [
    "a) Decret 136/1999",
    "b) Decret 240/2002",
    "c) Decret 815/2013",
    "d) Decret 500/1996"
  ],
  correcta: "a"
},
{
  texto: "Quina llei catalana substitueix la LIIAA i deroga la Llei 3/1998?",
  opciones: [
    "a) Llei 16/2002",
    "b) Llei 20/2009 (PCAA)",
    "c) Llei 21/1990",
    "d) Llei 5/2013"
  ],
  correcta: "b"
},
{
  texto: "Quan entra en vigor la Llei 20/2009 (PCAA)?",
  opciones: [
    "a) El 2008",
    "b) Lâ€™agost de 2010",
    "c) El 2013",
    "d) El 2016"
  ],
  correcta: "b"
},
{
  texto: "QuÃ¨ estableix la Llei 20/2009 respecte a la naturalesa dels permisos?",
  opciones: [
    "a) Que sÃ³n indefinits i no cal renovaciÃ³",
    "b) Que tenen data de caducitat i requereixen controls periÃ²dics",
    "c) Que nomÃ©s sâ€™apliquen a empreses pÃºbliques",
    "d) Que es poden renovar automÃ ticament cada 20 anys"
  ],
  correcta: "b"
},
{
  texto: "Quin tipus de control fan les Entitats Ambientals ColÂ·laboradores (EAC)?",
  opciones: [
    "a) Controlen el compliment ambiental i realitzen inspeccions periÃ²diques",
    "b) Gestionen els permisos dâ€™obra nova",
    "c) Fan controls de seguretat alimentÃ ria",
    "d) NomÃ©s elaboren informes econÃ²mics"
  ],
  correcta: "a"
},
{
  texto: "Com classifica la Llei 20/2009 les activitats segons el seu impacte?",
  opciones: [
    "a) Annex I (alt), Annex II (mitjÃ ) i Annex III (baix)",
    "b) Annex A, B i C",
    "c) Nivell 1, 2 i 3 segons potÃ¨ncia elÃ¨ctrica",
    "d) Industrial, comercial i agrÃ­cola"
  ],
  correcta: "a"
},
{
  texto: "Qui atorga les autoritzacions ambientals per a activitats de lâ€™Annex I a Catalunya?",
  opciones: [
    "a) Els ajuntaments",
    "b) Els consells comarcals",
    "c) La Generalitat de Catalunya",
    "d) El Ministeri per a la TransiciÃ³ EcolÃ²gica"
  ],
  correcta: "c"
},
{
  texto: "Qui tÃ© competÃ¨ncia per a les activitats dels annexos II i III a Catalunya?",
  opciones: [
    "a) Ajuntaments i consells comarcals si hi ha menys de 50.000 habitants",
    "b) NomÃ©s la Generalitat",
    "c) El Parlament Europeu",
    "d) Els inspectors del Ministeri"
  ],
  correcta: "a"
},
{
  texto: "Quin Ã©s el termini mÃ xim per resoldre un expedient dâ€™autoritzaciÃ³ ambiental segons lâ€™annex I?",
  opciones: [
    "a) 4 mesos",
    "b) 6 mesos",
    "c) 8 mesos",
    "d) 12 mesos"
  ],
  correcta: "c"
},
{
  texto: "Quin Ã©s el termini per resoldre una llicÃ¨ncia ambiental dâ€™un Annex II?",
  opciones: [
    "a) 4 mesos",
    "b) 6 mesos",
    "c) 8 mesos",
    "d) 10 mesos"
  ],
  correcta: "b"
},
{
  texto: "QuÃ¨ implica el silenci administratiu negatiu a la Llei 20/2009?",
  opciones: [
    "a) Que si no hi ha resposta dins del termini, lâ€™activitat pot comenÃ§ar igualment",
    "b) Que si no hi ha resoluciÃ³ dins del termini, lâ€™activitat no pot iniciar-se",
    "c) Que lâ€™activitat queda autoritzada automÃ ticament",
    "d) Que cal tornar a presentar la solÂ·licitud sense cost"
  ],
  correcta: "b"
},
{
  texto: "QuÃ¨ permet el rÃ¨gim de comunicaciÃ³ de lâ€™Annex III?",
  opciones: [
    "a) ComenÃ§ar lâ€™activitat lâ€™endemÃ  de la comunicaciÃ³ a lâ€™ajuntament",
    "b) Esperar una inspecciÃ³ prÃ¨via obligatÃ²ria",
    "c) Demanar una autoritzaciÃ³ de nivell superior",
    "d) Fer una avaluaciÃ³ ambiental completa"
  ],
  correcta: "a"
}
];
// --- FRASES DE ÃNIMO ---
const frases_animo = [
Â  "Â¡Muy bien! ğŸ˜",
Â  "Â¡Eso es, perfecto, te camelo caramelo! ğŸ”¥",
Â  "Â¡Ole tÃº huevos! ğŸ’ª",
Â  "Â¡Exacto, estÃ¡s on fire! ğŸš€",
Â  "Â¡QuÃ© mÃ¡quina eres! ğŸ˜",
Â  "Â¡Correcto, asÃ­ se hace! ğŸ‘",
Â  "Â¡Te lo sabes de memoria ya! ğŸ’¥"
];

// --- VARIABLES ---
let i = 0;
let puntuacion = 0;
let preguntasParaEsteTest = [];

// --- FUNCIONES ---

/**
 * Baraja un array aleatoriamente (algoritmo Fisher-Yates).
 * @param {Array} array El array a barajar.
 */
function barajarPreguntas(array) {
  let currentIndex = array.length,  randomIndex;

  while (currentIndex != 0) {
    randomIndex = Math.floor(Math.random() * currentIndex);
    currentIndex--;
    [array[currentIndex], array[randomIndex]] = [
      array[randomIndex], array[currentIndex]];
  }
  return array;
}

/**
 * Muestra un mensaje en el chat.
 * @param {string} texto El contenido del mensaje.
 * @param {string} tipo 'bot' o 'user'.
 */
function mostrarMensaje(texto, tipo) {
Â  const chat = document.getElementById("chat");
Â  const msg = document.createElement("div");
Â  msg.classList.add("message", tipo);
  // Convierte los saltos de lÃ­nea (\n) en etiquetas <br>
Â  msg.innerHTML = texto.replace(/\n/g, "<br>");
Â  chat.appendChild(msg);
Â  chat.scrollTop = chat.scrollHeight;
}

/**
 * Muestra la pregunta actual y sus opciones en un solo mensaje.
 */
function mostrarPregunta() {
  // Usa el array de 20 preguntas
Â  if (!preguntasParaEsteTest[i]) return;

Â  const p = preguntasParaEsteTest[i];
  // Une la pregunta y las opciones en un solo texto
Â  const textoCompleto = `${p.texto}\n\n${p.opciones.join("\n")}`;
Â  mostrarMensaje(textoCompleto, "bot");
}

/**
 * Procesa la respuesta del usuario.
 * @param {string} opcionElegida "a", "b", "c" o "d".
 */
function responder(opcionElegida) {
  // Usa el array de 20 preguntas
Â  if (!preguntasParaEsteTest[i]) return;

Â  const p = preguntasParaEsteTest[i];
  // Muestra solo la letra, como pediste
Â  mostrarMensaje(`${opcionElegida.toUpperCase()}`, "user");

Â  if (opcionElegida === p.correcta) {
Â  Â  puntuacion++;
Â  Â  mostrarMensaje(frases_animo[Math.floor(Math.random() * frases_animo.length)], "bot");
Â  } else {
Â  Â  mostrarMensaje(`âŒ Incorrecto. La respuesta correcta era ${p.correcta.toUpperCase()}.`, "bot");
Â  }

Â  i++;
  // Comprueba si quedan preguntas en el array de 20
Â  if (i < preguntasParaEsteTest.length) {
Â  Â  setTimeout(mostrarPregunta, 800);
Â  } else {
Â  Â  setTimeout(() => {
      // Muestra la puntuaciÃ³n final sobre 20 (o el total que haya)
Â  Â  Â  mostrarMensaje(`ğŸ Has acertado ${puntuacion} de ${preguntasParaEsteTest.length} preguntas. ğŸ’¡`, "bot");
Â  Â  Â  desactivarBotones();
Â  Â  }, 800);
Â  }
}

/**
 * Desactiva los botones de opciÃ³n al final del test.
 */
function desactivarBotones() {
Â  document.querySelectorAll(".btn-opcion").forEach(btn => btn.disabled = true);
}

// --- ARRANQUE ---
document.addEventListener("DOMContentLoaded", () => {
Â  i = 0;
Â  puntuacion = 0;
  
  // 1. Barajamos TODO el array de preguntas
  barajarPreguntas(preguntas); 
  
  // 2. Nos quedamos solo con las 20 primeras (o menos, si el array es mÃ¡s corto)
  preguntasParaEsteTest = preguntas.slice(0, 20); 

Â  mostrarMensaje(`ğŸ§  Bienvenido al test. Se han elegido ${preguntasParaEsteTest.length} preguntas al azar. ğŸ’¬`, "bot");
Â  setTimeout(mostrarPregunta, 500);

Â  document.getElementById("btnA").onclick = () => responder("a");
Â  document.getElementById("btnB").onclick = () => responder("b");
Â  document.getElementById("btnC").onclick = () => responder("c");
Â  document.getElementById("btnD").onclick = () => responder("d");
});


